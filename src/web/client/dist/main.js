/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e,t,s,i,r={169:(e,t,s)=>{s.d(t,{d$:()=>D});const i="w",r="b",o="p",a="b",n="r",h="q",c="k",l="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",d=-1,u={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},p={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},m={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},v={b:[16,32,17,15],w:[-16,-32,-17,-15]},b={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},g=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],f=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],w={p:1,n:2,b:4,r:8,q:16,k:32},k=["n",a,n,h],_={[c]:p.KSIDE_CASTLE,[h]:p.QSIDE_CASTLE},S={w:[{square:m.a1,flag:p.QSIDE_CASTLE},{square:m.h1,flag:p.KSIDE_CASTLE}],b:[{square:m.a8,flag:p.QSIDE_CASTLE},{square:m.h8,flag:p.KSIDE_CASTLE}]},y={b:1,w:6},q=["1-0","0-1","1/2-1/2","*"];function E(e){return e>>4}function C(e){return 15&e}function I(e){return-1!=="0123456789".indexOf(e)}function P(e){const t=C(e),s=E(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(s,s+1)}function x(e){return e===i?r:i}function T(e,t,s,i,r,a=void 0,n=p.NORMAL){const h=E(i);if(r!==o||7!==h&&0!==h)e.push({color:t,from:s,to:i,piece:r,captured:a,flags:n});else for(let o=0;o<k.length;o++){const h=k[o];e.push({color:t,from:s,to:i,piece:r,captured:a,promotion:h,flags:n|p.PROMOTION})}}function M(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return o}return t=t.toLowerCase(),"o"===t?c:t}function A(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function L(e){return e.split(" ").slice(0,4).join(" ")}class D{_board=new Array(128);_turn=i;_header={};_kings={w:d,b:d};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_positionCount={};constructor(e=l){this.load(e)}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:d,b:d},this._turn=i,this._castling={w:0,b:0},this._epSquare=d,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}removeHeader(e){e in this._header&&delete this._header[e]}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let o=e.split(/\s+/);if(o.length>=2&&o.length<6){const t=["-","-","0","1"];e=o.concat(t.slice(-(6-o.length))).join(" ")}if(o=e.split(/\s+/),!t){const{ok:t,error:s}=function(e){const t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const s=parseInt(t[5],10);if(isNaN(s)||s<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(t[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=t[0].split("/");if(8!==r.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<r.length;e++){let t=0,s=!1;for(let i=0;i<r[e].length;i++)if(I(r[e][i])){if(s)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(r[e][i],10),s=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[e][i]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,s=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:e,regex:s}of o){if(!s.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(s)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(r[0]+r[7]).some((e=>"P"===e.toUpperCase()))?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw new Error(s)}const a=o[0];let n=0;this.clear({preserveHeaders:s});for(let e=0;e<a.length;e++){const t=a.charAt(e);if("/"===t)n+=8;else if(I(t))n+=parseInt(t,10);else{const e=t<"a"?i:r;this._put({type:t.toLowerCase(),color:e},P(n)),n++}}this._turn=o[1],o[2].indexOf("K")>-1&&(this._castling.w|=p.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(this._castling.w|=p.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(this._castling.b|=p.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(this._castling.b|=p.QSIDE_CASTLE),this._epSquare="-"===o[3]?d:m[o[3]],this._halfMoves=parseInt(o[4],10),this._moveNumber=parseInt(o[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){let e=0,t="";for(let s=m.a8;s<=m.h1;s++){if(this._board[s]){e>0&&(t+=e,e=0);const{color:r,type:o}=this._board[s];t+=r===i?o.toUpperCase():o.toLowerCase()}else e++;s+1&136&&(e>0&&(t+=e),s!==m.h1&&(t+="/"),e=0,s+=8)}let s="";this._castling[i]&p.KSIDE_CASTLE&&(s+="K"),this._castling[i]&p.QSIDE_CASTLE&&(s+="Q"),this._castling[r]&p.KSIDE_CASTLE&&(s+="k"),this._castling[r]&p.QSIDE_CASTLE&&(s+="q"),s=s||"-";let a="-";if(this._epSquare!==d){const e=this._epSquare+(this._turn===i?16:-16),t=[e+1,e-1];for(const e of t){if(136&e)continue;const t=this._turn;if(this._board[e]?.color===t&&this._board[e]?.type===o){this._makeMove({color:t,from:e,to:this._epSquare,piece:o,captured:o,flags:p.EP_CAPTURE});const s=!this._isKingAttacked(t);if(this._undoMove(),s){a=P(this._epSquare);break}}}}return[t,this._turn,s,a,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==l?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(l)}get(e){return this._board[m[e]]||!1}put({type:e,color:t},s){return!!this._put({type:e,color:t},s)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_put({type:e,color:t},s){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase()))return!1;if(!(s in m))return!1;const i=m[s];if(e==c&&this._kings[t]!=d&&this._kings[t]!=i)return!1;const r=this._board[i];return r&&r.type===c&&(this._kings[r.color]=d),this._board[i]={type:e,color:t},e===c&&(this._kings[t]=i),!0}remove(e){const t=this.get(e);return delete this._board[m[e]],t&&t.type===c&&(this._kings[t.color]=d),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){const e=this._board[m.e1]?.type===c&&this._board[m.e1]?.color===i,t=this._board[m.e8]?.type===c&&this._board[m.e8]?.color===r;e&&this._board[m.a1]?.type===n&&this._board[m.a1]?.color===i||(this._castling.w&=~p.QSIDE_CASTLE),e&&this._board[m.h1]?.type===n&&this._board[m.h1]?.color===i||(this._castling.w&=~p.KSIDE_CASTLE),t&&this._board[m.a8]?.type===n&&this._board[m.a8]?.color===r||(this._castling.b&=~p.QSIDE_CASTLE),t&&this._board[m.h8]?.type===n&&this._board[m.h8]?.color===r||(this._castling.b&=~p.KSIDE_CASTLE)}_updateEnPassantSquare(){if(this._epSquare===d)return;const e=this._epSquare+(this._turn===i?-16:16),t=this._epSquare+(this._turn===i?16:-16),s=[t+1,t-1];null===this._board[e]&&null===this._board[this._epSquare]&&this._board[t]?.color===x(this._turn)&&this._board[t]?.type===o&&s.some((e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type===o))||(this._epSquare=d)}_attacked(e,t){for(let s=m.a8;s<=m.h1;s++){if(136&s){s+=7;continue}if(void 0===this._board[s]||this._board[s].color!==e)continue;const a=this._board[s],n=s-t;if(0===n)continue;const h=n+119;if(g[h]&w[a.type]){if(a.type===o){if(n>0){if(a.color===i)return!0}else if(a.color===r)return!0;continue}if("n"===a.type||"k"===a.type)return!0;const e=f[h];let c=s+e,l=!1;for(;c!==t;){if(null!=this._board[c]){l=!0;break}c+=e}if(!l)return!0}}return!1}_isKingAttacked(e){const t=this._kings[e];return-1!==t&&this._attacked(x(e),t)}isAttacked(e,t){return this._attacked(t,m[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,i=0;for(let r=m.a8;r<=m.h1;r++){if(i=(i+1)%2,136&r){r+=7;continue}const o=this._board[r];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===a&&t.push(i),s++)}if(2===s)return!0;if(3===s&&(1===e[a]||1===e.n))return!0;if(s===e[a]+2){let e=0;const s=t.length;for(let i=0;i<s;i++)e+=t[i];if(0===e||e===s)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t,piece:s}={}){const i=this._moves({square:t,piece:s});return e?i.map((e=>this._makePretty(e))):i.map((e=>this._moveToSan(e,i)))}_moves({legal:e=!0,piece:t,square:s}={}){const i=s?s.toLowerCase():void 0,r=t?.toLowerCase(),a=[],n=this._turn,h=x(n);let l=m.a8,d=m.h1,u=!1;if(i){if(!(i in m))return[];l=d=m[i],u=!0}for(let e=l;e<=d;e++){if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===h)continue;const{type:t}=this._board[e];let s;if(t===o){if(r&&r!==t)continue;s=e+v[n][0],this._board[s]||(T(a,n,e,s,o),s=e+v[n][1],y[n]!==E(e)||this._board[s]||T(a,n,e,s,o,void 0,p.BIG_PAWN));for(let t=2;t<4;t++)s=e+v[n][t],136&s||(this._board[s]?.color===h?T(a,n,e,s,o,this._board[s].type,p.CAPTURE):s===this._epSquare&&T(a,n,e,s,o,o,p.EP_CAPTURE))}else{if(r&&r!==t)continue;for(let i=0,r=b[t].length;i<r;i++){const r=b[t][i];for(s=e;s+=r,!(136&s);){if(this._board[s]){if(this._board[s].color===n)break;T(a,n,e,s,t,this._board[s].type,p.CAPTURE);break}if(T(a,n,e,s,t),"n"===t||t===c)break}}}}if(!(void 0!==r&&r!==c||u&&d!==this._kings[n])){if(this._castling[n]&p.KSIDE_CASTLE){const e=this._kings[n],t=e+2;this._board[e+1]||this._board[t]||this._attacked(h,this._kings[n])||this._attacked(h,e+1)||this._attacked(h,t)||T(a,n,this._kings[n],t,c,void 0,p.KSIDE_CASTLE)}if(this._castling[n]&p.QSIDE_CASTLE){const e=this._kings[n],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(h,this._kings[n])||this._attacked(h,e-1)||this._attacked(h,t)||T(a,n,this._kings[n],t,c,void 0,p.QSIDE_CASTLE)}}if(!e||-1===this._kings[n])return a;const g=[];for(let e=0,t=a.length;e<t;e++)this._makeMove(a[e]),this._isKingAttacked(n)||g.push(a[e]),this._undoMove();return g}move(e,{strict:t=!1}={}){let s=null;if("string"==typeof e)s=this._moveFromSan(e,t);else if("object"==typeof e){const t=this._moves();for(let i=0,r=t.length;i<r;i++)if(e.from===P(t[i].from)&&e.to===P(t[i].to)&&(!("promotion"in t[i])||e.promotion===t[i].promotion)){s=t[i];break}}if(!s)throw"string"==typeof e?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const i=this._makePretty(s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,s=x(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&p.EP_CAPTURE&&(this._turn===r?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===c){if(this._kings[t]=e.to,e.flags&p.KSIDE_CASTLE){const t=e.to-1,s=e.to+1;this._board[t]=this._board[s],delete this._board[s]}else if(e.flags&p.QSIDE_CASTLE){const t=e.to+1,s=e.to-2;this._board[t]=this._board[s],delete this._board[s]}this._castling[t]=0}if(this._castling[t])for(let s=0,i=S[t].length;s<i;s++)if(e.from===S[t][s].square&&this._castling[t]&S[t][s].flag){this._castling[t]^=S[t][s].flag;break}if(this._castling[s])for(let t=0,i=S[s].length;t<i;t++)if(e.to===S[s][t].square&&this._castling[s]&S[s][t].flag){this._castling[s]^=S[s][t].flag;break}e.flags&p.BIG_PAWN?this._epSquare=t===r?e.to-16:e.to+16:this._epSquare=d,e.piece===o||e.flags&(p.CAPTURE|p.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===r&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();if(e){const t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(void 0===e)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,i=x(s);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&p.EP_CAPTURE){let e;e=s===r?t.to-16:t.to+16,this._board[e]={type:o,color:i}}else this._board[t.to]={type:t.captured,color:i};if(t.flags&(p.KSIDE_CASTLE|p.QSIDE_CASTLE)){let e,s;t.flags&p.KSIDE_CASTLE?(e=t.to+1,s=t.to-1):(e=t.to-2,s=t.to+1),this._board[e]=this._board[s],delete this._board[s]}return t}pgn({newline:e="\n",maxWidth:t=0}={}){const s=[];let i=!1;for(const t in this._header)s.push("["+t+' "'+this._header[t]+'"]'+e),i=!0;i&&this._history.length&&s.push(e);const r=e=>{const t=this._comments[this.fen()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let n="";for(0===o.length&&a.push(r(""));o.length>0;){n=r(n);const e=o.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(n.length&&a.push(n),n=this._moveNumber+".");else{const e=`${this._moveNumber}. ...`;n=n?`${n} ${e}`:e}n=n+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(n.length&&a.push(r(n)),void 0!==this._header.Result&&a.push(this._header.Result),0===t)return s.join("")+a.join(" ");const h=function(){return s.length>0&&" "===s[s.length-1]&&(s.pop(),!0)},c=function(i,r){for(const o of r.split(" "))if(o){if(i+o.length>t){for(;h();)i--;s.push(e),i=0}s.push(o),i+=o.length,s.push(" "),i++}return h()&&i--,i};let l=0;for(let i=0;i<a.length;i++)l+a[i].length>t&&a[i].includes("{")?l=c(l,a[i]):(l+a[i].length>t&&0!==i?(" "===s[s.length-1]&&s.pop(),s.push(e),l=0):0!==i&&(s.push(" "),l++),s.push(a[i]),l+=a[i].length);return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{strict:t=!1,newlineChar:s="\r?\n"}={}){function i(e){return e.replace(/\\/g,"\\")}e=e.trim();const r=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(e),o=r&&r.length>=2?r[1]:"";this.reset();const a=function(e){const t={},r=e.split(new RegExp(i(s)));let o="",a="";for(let e=0;e<r.length;e++){const s=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;o=r[e].replace(s,"$1"),a=r[e].replace(s,"$2"),o.trim().length>0&&(t[o]=a)}return t}(o);let n="";for(const e in a)"fen"===e.toLowerCase()&&(n=a[e]),this.header(e,a[e]);if(t){if("1"===a.SetUp){if(!("FEN"in a))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(a.FEN,{preserveHeaders:!0})}}else n&&this.load(n,{preserveHeaders:!0});const h=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(i(s),"g")," ")).slice(1,e.length-1))}}`},c=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+(e.match(/.{1,2}/g)||[]).join("%"))}(e.slice(1,e.length-1))};let l=e.replace(o,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),(function(e,t,s){return void 0!==t?h(t):" "+h(`{${s.slice(1)}}`)})).replace(new RegExp(i(s),"g")," ");const d=/(\([^()]+\))+?/g;for(;d.test(l);)l=l.replace(d,"");l=l.replace(/\d+\.(\.\.)?/g,""),l=l.replace(/\.\.\./g,""),l=l.replace(/\$\d+/g,"");let u=l.trim().split(new RegExp(/\s+/));u=u.filter((e=>""!==e));let p="";for(let e=0;e<u.length;e++){const s=c(u[e]);if(void 0!==s){this._comments[this.fen()]=s;continue}const i=this._moveFromSan(u[e],t);if(null==i){if(!(q.indexOf(u[e])>-1))throw new Error(`Invalid move in PGN: ${u[e]}`);p=u[e]}else p="",this._makeMove(i),this._incPositionCount(this.fen())}p&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",p)}_moveToSan(e,t){let s="";if(e.flags&p.KSIDE_CASTLE)s="O-O";else if(e.flags&p.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==o){const i=function(e,t){const s=e.from,i=e.to,r=e.piece;let o=0,a=0,n=0;for(let e=0,h=t.length;e<h;e++){const h=t[e].from,c=t[e].to;r===t[e].piece&&s!==h&&i===c&&(o++,E(s)===E(h)&&a++,C(s)===C(h)&&n++)}return o>0?a>0&&n>0?P(s):n>0?P(s).charAt(1):P(s).charAt(0):""}(e,t);s+=e.piece.toUpperCase()+i}e.flags&(p.CAPTURE|p.EP_CAPTURE)&&(e.piece===o&&(s+=P(e.from)[0]),s+="x"),s+=P(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){const s=A(e);let i,r,o,a,n,h=M(s),c=this._moves({legal:!0,piece:h});for(let e=0,t=c.length;e<t;e++)if(s===A(this._moveToSan(c[e],c)))return c[e];if(t)return null;let l=!1;if(r=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),r?(i=r[1],o=r[2],a=r[3],n=r[4],1==o.length&&(l=!0)):(r=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),r&&(i=r[1],o=r[2],a=r[3],n=r[4],1==o.length&&(l=!0))),h=M(s),c=this._moves({legal:!0,piece:i||h}),!a)return null;for(let e=0,t=c.length;e<t;e++)if(o){if(!(i&&i.toLowerCase()!=c[e].piece||m[o]!=c[e].from||m[a]!=c[e].to||n&&n.toLowerCase()!=c[e].promotion))return c[e];if(l){const t=P(c[e].from);if(!(i&&i.toLowerCase()!=c[e].piece||m[a]!=c[e].to||o!=t[0]&&o!=t[1]||n&&n.toLowerCase()!=c[e].promotion))return c[e]}}else if(s===A(this._moveToSan(c[e],c)).replace("x",""))return c[e];return null}ascii(){let e="   +------------------------+\n";for(let t=m.a8;t<=m.h1;t++){if(0===C(t)&&(e+=" "+"87654321"[E(t)]+" |"),this._board[t]){const s=this._board[t].type;e+=" "+(this._board[t].color===i?s.toUpperCase():s.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const i=this._turn;for(let r=0,o=t.length;r<o;r++)this._makeMove(t[r]),this._isKingAttacked(i)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:t,piece:s,from:i,to:r,flags:o,captured:a,promotion:n}=e;let h="";for(const e in p)p[e]&o&&(h+=u[e]);const c=P(i),l=P(r),d={color:t,piece:s,from:c,to:l,san:this._moveToSan(e,this._moves({legal:!0})),flags:h,lan:c+l,before:this.fen(),after:""};return this._makeMove(e),d.after=this.fen(),this._undoMove(),a&&(d.captured=a),n&&(d.promotion=n,d.lan+=n),d}turn(){return this._turn}board(){const e=[];let t=[];for(let s=m.a8;s<=m.h1;s++)null==this._board[s]?t.push(null):t.push({square:P(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in m){const t=m[e];return(E(t)+C(t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?s.push(this._makePretty(i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(e){const t=L(e);return this._positionCount[t]||0}_incPositionCount(e){const t=L(e);void 0===this._positionCount[t]&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=L(e);1===this._positionCount[t]?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},s=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const t=e.pop();if(!t)break;this._makeMove(t),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map((e=>({fen:e,comment:this._comments[e]})))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map((e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}}))}setCastlingRights(e,t){for(const s of[c,h])void 0!==t[s]&&(t[s]?this._castling[e]|=_[s]:this._castling[e]&=~_[s]);this._updateCastlingRights();const s=this.getCastlingRights(e);return!(void 0!==t[c]&&t[c]!==s[c]||void 0!==t[h]&&t[h]!==s[h])}getCastlingRights(e){return{[c]:!!(this._castling[e]&_[c]),[h]:!!(this._castling[e]&_[h])}}moveNumber(){return this._moveNumber}}},325:(e,t,s)=>{s.a(e,(async(e,t)=>{try{var i=s(169),r=s(410),o=s(578),a=s(443),n=s(752),h=s(804);const l="https://chessbackens1-b8dd17cc7906.herokuapp.com/";console.log("API URL: ",l);let d=null;async function u(){const e=await fetch(`${l}/new_game/1`,{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();"success"===t.status?(d=t.game_id,console.log("Game created with ID:",d)):console.error("Error creating game:",t.message)}await u();let p=!1;var c=new i.d$;const m=new r.Ve(document.getElementById("board"),{position:c.fen(),assetsUrl:"./assets/",style:{borderType:r.qi.none,pieces:{file:"pieces/standard.svg"},animationDuration:300},orientation:r.o$.white,extensions:[{class:o.c,props:{autoMarkers:o.w.square}},{class:a.M},{class:n.T}]});document.getElementById("flipBoardButton").addEventListener("click",(()=>{m.setOrientation(m.getOrientation()===r.o$.white?r.o$.black:r.o$.white),v.classList.toggle("hidden",!0),setTimeout((e=>{k()}),300)})),document.getElementById("autoPlayButton").addEventListener("click",(()=>{p=!p,k()}));const v=document.getElementById("overlay"),b=document.getElementById("gameOverText"),g=document.getElementById("gameCode");function f(e){c.move(e),m.setPosition(c.fen(),!0),setTimeout((e=>{k()}),100)}async function w(e){const t=c.moves({verbose:!0}),s=await h.S(d);s?f(s):(console.log("Bot can't make move so it will make a random move"),f(t[Math.floor(Math.random()*t.length)]))}function k(){return c.isCheckmate()?(b.innerText=c.turn()===m.getOrientation()?"You got checkmated!":"You checkmated the opponent!",void v.classList.toggle("hidden",!1)):c.isDraw()?(c.loadPgn(c.pgn()+" 1/2-1/2"),b.innerText="It's a draw!",void v.classList.toggle("hidden",!1)):void(c.turn()!==m.getOrientation()||p?(m.disableMoveInput(),w()):m.enableMoveInput(S,m.getOrientation()))}async function _(e){if(!d)return void console.error("No game ID available.");const t=await fetch(`${l}/move/${d}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({move:{move:e}})}),s=await t.json();"success"===s.status||console.error("Error making move:",s.message)}function S(e){if(e.type!==r.n1.movingOverSquare){if(e.type!==r.n1.moveInputFinished&&e.chessboard.removeLegalMovesMarkers(),e.type===r.n1.moveInputStarted){const t=c.moves({square:e.squareFrom,verbose:!0});return e.chessboard.addLegalMovesMarkers(t),t.length>0}if(e.type!==r.n1.moveInputFinished){if(e.type===r.n1.validateMoveInput){const t={from:e.squareFrom,to:e.squareTo,promotion:e.promotion};let s=!1;try{s=c.move(t),e.chessboard.state.moveInputProcess.then((()=>{e.chessboard.setPosition(c.fen(),!0).then((()=>{k()}))})),_(t)}catch(t){let s=c.moves({square:e.squareFrom,verbose:!0});for(const t of s)if(t.promotion&&t.to===e.squareTo)return e.chessboard.showPromotionDialog(e.squareTo,r.o$.white,(t=>{if(t.type===a.O.pieceSelected){const s={from:e.squareFrom,to:e.squareTo,promotion:t.piece.charAt(1)};f(s),_(s)}else e.chessboard.enableMoveInput(S,e.chessboard.getOrientation()),e.chessboard.setPosition(c.fen(),!0)})),!0}return s}}else e.legalMove&&e.chessboard.disableMoveInput()}}document.getElementById("restartButton").addEventListener("click",(()=>{c.reset(),m.setPosition(c.fen(),!0),v.classList.toggle("hidden",!0),k(),u()})),g.addEventListener("click",(()=>{navigator.clipboard.writeText(c.pgn()+" *").then((()=>{alert("Game code copied to clipboard!")}))})),m.enableMoveInput(S,r.o$.white),t()}catch(y){t(y)}}),1)},804:(e,t,s)=>{s.d(t,{S:()=>r});const i="https://chessbackens1-b8dd17cc7906.herokuapp.com/";async function r(e){if(!e)return void console.error("No game ID available. Cannot get engine move.");const t=await fetch(`${i}/engine_move/${e}`,{method:"PUT"}),s=await t.json();if(console.log("Engine move data: ",s),"success"===s.status){const e=s.next_move;return console.log("Engine move: ",e),e}return console.error("Error fetching engine move: ",s),null}},410:(e,t,s)=>{s.d(t,{qi:()=>b,o$:()=>m,Ve:()=>w,n1:()=>v,TJ:()=>f});const i="8/8/8/8/8/8/8/8";class r{constructor(e=i){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=i){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let e=0;e<8;e++){const s=t[7-e].replace(/\d/g,(e=>{const t=parseInt(e);let s="";for(let e=0;e<t;e++)s+="-";return s}));for(let t=0;t<8;t++){const i=s.substring(t,t+1);let r=null;"-"!==i&&(r=i.toUpperCase()===i?`w${i.toLowerCase()}`:`b${i}`),this.squares[8*e+t]=r}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let s=0;for(let i=0;i<8;i++){const r=this.squares[8*t+i];if(r){s>0&&(e[7-t]+=s,s=0);const i=r.substring(0,1),o=r.substring(1,2);e[7-t]+="w"===i?o.toUpperCase():o}else s++}s>0&&(e[7-t]+=s,s=0)}return e.join("/")}getPieces(e=void 0,t=void 0,s=["k","q","r","b","n","p"]){const i=[];for(let s=0;s<64;s++){const o=this.squares[s];if(o){const a=o.charAt(1),n=o.charAt(0),h=r.indexToSquare(s);if(t&&t!==a||e&&e!==n)continue;i.push({name:a,type:a,color:n,position:h,square:h})}}return s&&i.sort(((e,t)=>s.indexOf(e.name)-s.indexOf(t.name))),i}movePiece(e,t){this.squares[r.squareToIndex(e)]?(this.squares[r.squareToIndex(t)]=this.squares[r.squareToIndex(e)],this.squares[r.squareToIndex(e)]=null):console.warn("no piece on",e)}setPiece(e,t){this.squares[r.squareToIndex(e)]=t}getPiece(e){return this.squares[r.squareToIndex(e)]}static squareToIndex(e){const t=r.squareToCoordinates(e);return t[0]+8*t[1]}static indexToSquare(e){return this.coordinatesToSquare([Math.floor(e%8),e/8])}static squareToCoordinates(e){return[e.charCodeAt(0)-97,e.charCodeAt(1)-49]}static coordinatesToSquare(e){return String.fromCharCode(e[0]+97)+String.fromCharCode(e[1]+49)}toString(){return this.getFen()}clone(){const e=new r;return e.squares=this.squares.slice(0),e}}class o{constructor(){this.position=new r,this.orientation=void 0,this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.squareSelectEnabled=!1,this.moveInputCallback=null,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}inputEnabled(){return this.inputWhiteEnabled||this.inputBlackEnabled}invokeExtensionPoints(e,t={}){const s=this.extensionPoints[e],i=Object.assign({},t);i.extensionPoint=e;let r=!0;if(s)for(const e of s)!1===e(i)&&(r=!1);return r}}var a=s(892),n=s(521),h=s(547);class c{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise(((t,s)=>{this.queue.push({promise:e,resolve:t,reject:s}),this.dequeue()}))}dequeue(){if(this.workingOnPromise)return;if(this.stop)return this.queue=[],void(this.stop=!1);const e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then((t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()})).catch((t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()}))}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}class l{constructor(e,t,s,i,r){this.view=e,t&&s?(this.animatedElements=this.createAnimation(t.squares,s.squares),this.duration=i,this.callback=r,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",s),this.view.positionsAnimationTask=h.A.createTask(),this.view.chessboard.state.invokeExtensionPoints(n.x.animation,{type:"start"})}static seekChanges(e,t){const s=[],i=[],r=[];for(let r=0;r<64;r++){const o=e[r],a=t[r];a!==o&&(a&&s.push({piece:a,index:r}),o&&i.push({piece:o,index:r}))}return s.forEach((e=>{let t=8,s=null;i.forEach((i=>{if(e.piece===i.piece){const r=l.squareDistance(e.index,i.index);r<t&&(s=i,t=r)}})),s?(i.splice(i.indexOf(s),1),r.push({type:0,piece:e.piece,atIndex:s.index,toIndex:e.index})):r.push({type:1,piece:e.piece,atIndex:e.index})})),i.forEach((e=>{r.push({type:2,piece:e.piece,atIndex:e.index})})),r}createAnimation(e,t){const s=l.seekChanges(e,t),i=[];return s.forEach((e=>{const t={type:e.type};switch(e.type){case 0:t.element=this.view.getPieceElement(r.indexToSquare(e.atIndex)),t.element.parentNode.appendChild(t.element),t.atPoint=this.view.indexToPoint(e.atIndex),t.toPoint=this.view.indexToPoint(e.toIndex);break;case 1:t.element=this.view.drawPieceOnSquare(r.indexToSquare(e.atIndex),e.piece),t.element.style.opacity=0;break;case 2:t.element=this.view.getPieceElement(r.indexToSquare(e.atIndex))}i.push(t)})),i}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e);const t=e-this.startTime;if(!(t<=this.duration))return cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach((e=>{2===e.type&&a.B.removeElement(e.element)})),this.view.positionsAnimationTask.resolve(),this.view.chessboard.state.invokeExtensionPoints(n.x.animation,{type:"end"}),void this.callback();this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));const s=Math.min(1,t/this.duration);let i=s<.5?2*s*s:(4-2*s)*s-1;(isNaN(i)||i>.99)&&(i=1),this.animatedElements.forEach((e=>{if(e.element)switch(e.type){case 0:e.element.transform.baseVal.removeItem(0);const t=this.view.svg.createSVGTransform();t.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*i,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*i),e.element.transform.baseVal.appendItem(t);break;case 1:e.element.style.opacity=Math.round(100*i)/100;break;case 2:e.element.style.opacity=Math.round(100*(1-i))/100}else console.warn("animatedItem has no element",e)})),this.view.chessboard.state.invokeExtensionPoints(n.x.animation,{type:"frame",progress:i})}static squareDistance(e,t){const s=e%8,i=Math.floor(e/8),r=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-i),Math.abs(r-s))}}class d extends c{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,s){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue((()=>new Promise((i=>{let r=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(r/=1+Math.pow(this.queue.length/5,2)),new l(this.chessboard.view,e,t,s?r:0,(()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),i()}))}))))}async enqueueTurnBoard(e,t,s){return super.enqueue((()=>new Promise((o=>{const a=new r(i);let n=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(n/=1+Math.pow(this.queue.length/5,2)),new l(this.chessboard.view,e,a,s?n:0,(()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(a.squares),new l(this.chessboard.view,a,e,s?n:0,(()=>{this.chessboard.view.redrawPieces(e.squares),o()}))}))}))))}}const u={waitForInputStart:"waitForInputStart",pieceClickedThreshold:"pieceClickedThreshold",clickTo:"clickTo",secondClickThreshold:"secondClickThreshold",dragTo:"dragTo",clickDragTo:"clickDragTo",moveDone:"moveDone",reset:"reset"};class p{constructor(e){this.view=e,this.chessboard=e.chessboard,this.moveInputState=null,this.fromSquare=null,this.toSquare=null,this.setMoveInputState(u.waitForInputStart)}moveInputStartedCallback(e){const t=this.view.moveInputStartedCallback(e);return t&&(this.chessboard.state.moveInputProcess=h.A.createTask(),this.chessboard.state.moveInputProcess.then((e=>{this.moveInputState!==u.waitForInputStart&&this.moveInputState!==u.moveDone||this.view.moveInputFinishedCallback(this.fromSquare,this.toSquare,e)}))),t}movingOverSquareCallback(e,t){this.view.movingOverSquareCallback(e,t)}validateMoveInputCallback(e,t){const s=this.view.validateMoveInputCallback(e,t);return this.chessboard.state.moveInputProcess.resolve(s),s}moveInputCanceledCallback(e,t,s){this.view.moveInputCanceledCallback(e,t,s),this.chessboard.state.moveInputProcess.resolve()}setMoveInputState(e,t=void 0){const s=this.moveInputState;switch(this.moveInputState=e,e){case u.waitForInputStart:break;case u.pieceClickedThreshold:if(u.waitForInputStart!==s&&u.clickTo!==s)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.fromSquare=t.square,this.toSquare=null,this.movedPiece=t.piece,this.startPoint=t.point,this.pointerMoveListener||this.pointerUpListener)throw Error("94ad0c");if("mousedown"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else{if("touchstart"!==t.type)throw Error("4b74af");this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener)}this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener));break;case u.clickTo:this.draggablePiece&&(a.B.removeElement(this.draggablePiece),this.draggablePiece=null),s===u.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case u.secondClickThreshold:if(u.clickTo!==s)throw new Error("moveInputState");this.startPoint=t.point;break;case u.dragTo:if(u.pieceClickedThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case u.clickDragTo:if(u.secondClickThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case u.moveDone:if(-1===[u.dragTo,u.clickTo,u.clickDragTo].indexOf(s))throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?this.chessboard.movePiece(this.fromSquare,this.toSquare,s===u.clickTo).then((()=>{s===u.clickTo&&this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(u.reset)})):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(u.reset));break;case u.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=null,this.toSquare=null,this.movedPiece=null,this.draggablePiece&&(a.B.removeElement(this.draggablePiece),this.draggablePiece=null),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=null),this.setMoveInputState(u.waitForInputStart);const i=this.view.piecesGroup.querySelectorAll("[visibility=hidden]");for(let e=0;e<i.length;e++)i[e].removeAttribute("visibility");break;default:throw Error(`260b09: moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece already exists");this.draggablePiece=a.B.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),s=a.B.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),i=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,r=this.draggablePiece.createSVGTransform();r.setScale(i,i),s.transform.baseVal.appendItem(r)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(("mousedown"!==e.type||0!==e.button)&&"touchstart"!==e.type)return;const t=e.target.getAttribute("data-square");if(!t)return;const s=this.chessboard.getPiece(t);let i;if(s&&(i=s?s.substring(0,1):null,("w"===i&&this.chessboard.state.inputWhiteEnabled||"b"===i&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==u.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&"w"===i||this.chessboard.state.inputBlackEnabled&&"b"===i){let r;if("mousedown"===e.type?r={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===u.waitForInputStart&&s&&this.moveInputStartedCallback(t))this.setMoveInputState(u.pieceClickedThreshold,{square:t,piece:s,point:r,type:e.type});else if(this.moveInputState===u.clickTo)if(t===this.fromSquare)this.setMoveInputState(u.secondClickThreshold,{square:t,piece:s,point:r,type:e.type});else{const s=this.chessboard.getPiece(t),o=s?s.substring(0,1):null,a=this.chessboard.getPiece(this.fromSquare),n=a?a.substring(0,1):null;i&&n===o?(this.moveInputCanceledCallback(this.fromSquare,t,"clickedAnotherPiece"),this.moveInputStartedCallback(t)?this.setMoveInputState(u.pieceClickedThreshold,{square:t,piece:s,point:r,type:e.type}):this.setMoveInputState(u.reset)):this.setMoveInputState(u.moveDone,{square:t})}}}onPointerMove(e){let t,s,i,r,o;if("mousemove"===e.type?(i=e.clientX,r=e.clientY,t=e.pageX,s=e.pageY,o=e.target):"touchmove"===e.type&&(i=e.touches[0].clientX,r=e.touches[0].clientY,t=e.touches[0].pageX,s=e.touches[0].pageY,o=document.elementFromPoint(i,r)),this.moveInputState===u.pieceClickedThreshold||this.moveInputState===u.secondClickThreshold)(Math.abs(this.startPoint.x-i)>4||Math.abs(this.startPoint.y-r)>4)&&(this.moveInputState===u.secondClickThreshold?this.setMoveInputState(u.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(u.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled()&&this.moveDraggablePiece(t,s));else if(this.moveInputState===u.dragTo||this.moveInputState===u.clickDragTo||this.moveInputState===u.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const e=o.getAttribute("data-square");e!==this.fromSquare&&e!==this.toSquare?(this.toSquare=e,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):e===this.fromSquare&&null!==this.toSquare&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null))}else null!==this.toSquare&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null));!this.view.chessboard.state.inputEnabled()||this.moveInputState!==u.dragTo&&this.moveInputState!==u.clickDragTo||this.moveDraggablePiece(t,s)}}onPointerUp(e){let t;if("mouseup"===e.type?t=e.target:"touchend"===e.type&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const e=t.getAttribute("data-square");if(e)this.moveInputState===u.dragTo||this.moveInputState===u.clickDragTo?this.fromSquare===e?this.moveInputState===u.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(e,null,"draggedBack"),this.setMoveInputState(u.reset)):this.setMoveInputState(u.clickTo,{square:e}):this.setMoveInputState(u.moveDone,{square:e}):this.moveInputState===u.pieceClickedThreshold?this.setMoveInputState(u.clickTo,{square:e}):this.moveInputState===u.secondClickThreshold&&(this.setMoveInputState(u.reset),this.moveInputCanceledCallback(e,null,"secondClick"));else{this.view.redrawPieces();const e=this.fromSquare;this.setMoveInputState(u.reset),this.moveInputCanceledCallback(e,null,"movedOutOfBoard")}}else this.view.redrawPieces(),this.setMoveInputState(u.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(u.reset),this.moveInputCanceledCallback(this.fromSquare,null,"secondaryClick")}isDragging(){return this.moveInputState===u.dragTo||this.moveInputState===u.clickDragTo}destroy(){this.setMoveInputState(u.reset)}}const m={white:"w",black:"b"},v={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled",moveInputFinished:"moveInputFinished"},b={none:"none",thin:"thin",frame:"frame"};class g{constructor(e){this.chessboard=e,this.visualMoveInput=new p(this),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.container=document.createElement("div"),this.chessboard.context.appendChild(this.container),e.props.responsive&&("undefined"!=typeof ResizeObserver?(this.resizeObserver=new ResizeObserver((()=>{setTimeout((()=>{this.handleResize()}))})),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.positionsAnimationTask=Promise.resolve(),this.pointerDownListener=this.pointerDownHandler.bind(this),this.container.addEventListener("mousedown",this.pointerDownListener),this.container.addEventListener("touchstart",this.pointerDownListener,{passive:!1}),this.createSvgAndGroups(),this.handleResize()}pointerDownHandler(e){this.visualMoveInput.onPointerDown(e)}destroy(){this.visualMoveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),a.B.removeElement(this.svg),this.container.remove()}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const s=document.createElement("div");s.style.transform="scale(0)",s.style.position="absolute",s.setAttribute("aria-hidden","true"),s.id=e,document.body.appendChild(s);const i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){s.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg=a.B.createSvg(this.container);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=a.B.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=a.B.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=a.B.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=a.B.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=a.B.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=a.B.addElement(this.svg,"g",{class:"markers-top-layer"}),this.interactiveTopLayer=a.B.addElement(this.svg,"g",{class:"interactive-top-layer"})}updateMetrics(){const e=this.chessboard.props.style.pieces.tileSize;this.width=this.container.clientWidth,this.height=this.container.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===b.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===b.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.container.style.width=this.chessboard.context.clientWidth+"px",this.container.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",this.container.clientWidth===this.width&&this.container.clientHeight===this.height||(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.chessboard.state.invokeExtensionPoints(n.x.beforeRedrawBoard),this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(n.x.afterRedrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(a.B.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===b.frame){const e=this.borderSize;a.B.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}for(let e=0;e<64;e++){const t=this.chessboard.state.orientation===m.white?e:63-e,s="square "+(9*t&8?"white":"black"),i=this.squareToPoint(r.indexToSquare(t)),o=a.B.addElement(this.boardGroup,"rect",{x:i.x,y:i.y,width:this.squareWidth,height:this.squareHeight});o.setAttribute("class",s),o.setAttribute("data-square",r.indexToSquare(t))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==b.frame;for(let t=0;t<8;t++){let s=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,i=this.height-3.5*this.scalingY,r="coordinate file";e&&(s+=15.5*this.scalingX,r+=t%2?" white":" black");const o=a.B.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${10*this.scalingY}px`});this.chessboard.state.orientation===m.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let s=this.borderSize/3.7,i=this.borderSize+25*this.scalingY+t*this.squareHeight,r="coordinate rank";e&&(r+=t%2?" black":" white",this.chessboard.props.style.borderType===b.frame?(s+=10*this.scalingX,i-=15*this.scalingY):(s+=2*this.scalingX,i-=15*this.scalingY));const o=a.B.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${10*this.scalingY}px`});this.chessboard.state.orientation===m.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes),s=this.visualMoveInput.isDragging();for(let t=0;t<64;t++){const i=e[t];if(i){const e=r.indexToSquare(t);this.drawPieceOnSquare(e,i,s&&e===this.visualMoveInput.fromSquare)}}for(const e of t)this.piecesGroup.removeChild(e)}drawPiece(e,t,s){const i=a.B.addElement(e,"g",{});i.setAttribute("data-piece",t);const r=this.svg.createSVGTransform();r.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(r);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=a.B.addElement(i,"use",{href:`${o}#${t}`,class:"piece"}),h=this.svg.createSVGTransform();return h.setScale(this.scalingY,this.scalingY),n.transform.baseVal.appendItem(h),i}drawPieceOnSquare(e,t,s=!1){const i=a.B.addElement(this.piecesGroup,"g",{});i.setAttribute("data-piece",t),i.setAttribute("data-square",e),s&&i.setAttribute("visibility","hidden");const r=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(r.x,r.y),i.transform.baseVal.appendItem(o);const n=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),h=a.B.addElement(i,"use",{href:`${n}#${t}`,class:"piece"}),c=this.svg.createSVGTransform();c.setTranslate(this.pieceXTranslate,0),h.transform.baseVal.appendItem(c);const l=this.svg.createSVGTransform();return l.setScale(this.scalingY,this.scalingY),h.transform.baseVal.appendItem(l),i}setPieceVisibility(e,t=!0){const s=this.getPieceElement(e);s?t?s.setAttribute("visibility","visible"):s.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;return this.piecesGroup.querySelector(`g[data-square='${e}']`)||(console.warn("no piece on",e),null)}enableMoveInput(e,t=null){if(this.chessboard.state.moveInputCallback)throw Error("moveInput already enabled");t===m.white?this.chessboard.state.inputWhiteEnabled=!0:(t===m.black||(this.chessboard.state.inputWhiteEnabled=!0),this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(n.x.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.moveInputCallback=null,this.chessboard.state.invokeExtensionPoints(n.x.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:v.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(t.moveInputCallbackResult=this.chessboard.state.moveInputCallback(t)),this.chessboard.state.invokeExtensionPoints(n.x.moveInput,t),t.moveInputCallbackResult}movingOverSquareCallback(e,t){const s={chessboard:this.chessboard,type:v.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.moveInputCallback&&(s.moveInputCallbackResult=this.chessboard.state.moveInputCallback(s)),this.chessboard.state.invokeExtensionPoints(n.x.moveInput,s)}validateMoveInputCallback(e,t){const s={chessboard:this.chessboard,type:v.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(s.moveInputCallbackResult=this.chessboard.state.moveInputCallback(s)),this.chessboard.state.invokeExtensionPoints(n.x.moveInput,s),s.moveInputCallbackResult}moveInputCanceledCallback(e,t,s){const i={chessboard:this.chessboard,type:v.moveInputCanceled,reason:s,squareFrom:e,squareTo:t};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(i),this.chessboard.state.invokeExtensionPoints(n.x.moveInput,i)}moveInputFinishedCallback(e,t,s){const i={chessboard:this.chessboard,type:v.moveInputFinished,squareFrom:e,squareTo:t,legalMove:s};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(i),this.chessboard.state.invokeExtensionPoints(n.x.moveInput,i)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,s;return this.chessboard.state.orientation===m.white?(t=this.borderSize+e%8*this.squareWidth,s=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,s=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:s}}squareToPoint(e){const t=r.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return h.A.isAbsoluteUrl(this.chessboard.props.style.pieces.file)?this.chessboard.props.style.pieces.file:this.chessboard.props.assetsUrl+this.chessboard.props.style.pieces.file}}const f={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"};class w{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:i,orientation:m.white,responsive:!0,assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:b.none,aspectRatio:1,pieces:{type:"svgSprite",file:"pieces/standard.svg",tileSize:40},animationDuration:300},extensions:[]},h.A.mergeObjects(this.props,t),this.state=new o,this.view=new g(this),this.positionAnimationsQueue=new d(this),this.state.orientation=this.props.orientation;for(const e of this.props.extensions)this.addExtension(e.class,e.props);this.view.redrawBoard(),this.state.position=new r(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(n.x.positionChanged),this.initialized=Promise.resolve()}async setPiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(n.x.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async movePiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(n.x.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async setPosition(e,t=!1){const s=this.state.position.clone(),i=new r(e);return s.getFen()!==i.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(n.x.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),t)}async setOrientation(e,t=!1){const s=this.state.position.clone();if(!this.boardTurning)return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(s,e,t).then((()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(n.x.boardChanged)}));console.warn("setOrientation is only once in queue allowed")}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}isMoveInputEnabled(){return this.state.inputWhiteEnabled||this.state.inputBlackEnabled}enableSquareSelect(e="pointerdown",t){this.squareSelectListener||(this.squareSelectListener=function(e){const s=e.target.getAttribute("data-square");t({eventType:e.type,event:e,chessboard:this,square:s})}),this.context.addEventListener(e,this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(e){this.context.removeEventListener(e,this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}isSquareSelectEnabled(){return this.state.squareSelectEnabled}addExtension(e,t){if(this.getExtension(e))throw Error('extension "'+e.name+'" already added');this.extensions.push(new e(this,t))}getExtension(e){for(const t of this.extensions)if(t instanceof e)return t;return null}destroy(){this.state.invokeExtensionPoints(n.x.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}}},752:(e,t,s)=>{s.d(t,{T:()=>a});var i=s(521),r=s(892),o=s(547);class a extends i.Y{constructor(e,t={}){super(e),this.registerExtensionPoint(i.x.afterRedrawBoard,(()=>{this.onRedrawBoard()})),this.props={sprite:"extensions/arrows/arrows.svg"},Object.assign(this.props,t),this.chessboard.props.assetsCache&&this.chessboard.view.cacheSpriteToDiv("cm-chessboard-arrows",this.getSpriteUrl()),e.addArrow=this.addArrow.bind(this),e.getArrows=this.getArrows.bind(this),e.removeArrows=this.removeArrows.bind(this),this.arrowGroup=r.B.addElement(e.view.markersTopLayer,"g",{class:"arrows"}),this.arrows=[]}onRedrawBoard(){for(;this.arrowGroup.firstChild;)this.arrowGroup.removeChild(this.arrowGroup.firstChild);this.arrows.forEach((e=>{this.drawArrow(e)}))}drawArrow(e){const t=r.B.addElement(this.arrowGroup,"g");t.setAttribute("data-arrow",e.from+e.to),t.setAttribute("class","arrow "+e.type.class);const s=this.chessboard.view,i=document.querySelectorAll('[data-square="'+e.from+'"]')[0],o=document.querySelectorAll('[data-square="'+e.to+'"]')[0],a=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=r.B.addElement(t,"defs"),h="arrow-"+e.from+e.to,c=r.B.addElement(n,"marker",{id:h,markerWidth:e.type.headSize,markerHeight:e.type.headSize,refX:20,refY:20,viewBox:"0 0 40 40",orient:"auto",class:"arrow-head"}),l=(r.B.addElement(c,"use",{href:`${a}#${e.type.slice}`}),i.x.baseVal.value+i.width.baseVal.value/2),d=o.x.baseVal.value+o.width.baseVal.value/2,u=i.y.baseVal.value+i.height.baseVal.value/2,p=o.y.baseVal.value+o.height.baseVal.value/2,m=(s.scalingX+s.scalingY)/2*4;let v=r.B.addElement(t,"line");v.setAttribute("x1",l.toString()),v.setAttribute("x2",d.toString()),v.setAttribute("y1",u.toString()),v.setAttribute("y2",p.toString()),v.setAttribute("class","arrow-line"),v.setAttribute("marker-end","url(#"+h+")"),v.setAttribute("stroke-width",m+"px")}addArrow(e,t,s){this.arrows.push(new n(t,s,e)),this.chessboard.view.redrawBoard()}getArrows(e=void 0,t=void 0,s=void 0){let i=[];return this.arrows.forEach((r=>{r.matches(t,s,e)&&i.push(r)})),i}removeArrows(e=void 0,t=void 0,s=void 0){this.arrows=this.arrows.filter((i=>!i.matches(t,s,e))),this.chessboard.view.redrawBoard()}getSpriteUrl(){return o.A.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class n{constructor(e,t,s){this.from=e,this.to=t,this.type=s}matches(e=void 0,t=void 0,s=void 0){return!(e&&e!==this.from||t&&t!==this.to||s&&s!==this.type)}}},578:(e,t,s)=>{s.d(t,{c:()=>h,w:()=>n});var i=s(521),r=s(892),o=s(410),a=s(547);const n={frame:{class:"marker-frame",slice:"markerFrame"},framePrimary:{class:"marker-frame-primary",slice:"markerFrame"},frameDanger:{class:"marker-frame-danger",slice:"markerFrame"},circle:{class:"marker-circle",slice:"markerCircle"},circlePrimary:{class:"marker-circle-primary",slice:"markerCircle"},circleDanger:{class:"marker-circle-danger",slice:"markerCircle"},square:{class:"marker-square",slice:"markerSquare"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class h extends i.Y{constructor(e,t={}){super(e),this.registerExtensionPoint(i.x.afterRedrawBoard,(()=>{this.onRedrawBoard()})),this.props={autoMarkers:n.frame,sprite:"extensions/markers/markers.svg"},Object.assign(this.props,t),e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.getSpriteUrl()),e.addMarker=this.addMarker.bind(this),e.getMarkers=this.getMarkers.bind(this),e.removeMarkers=this.removeMarkers.bind(this),e.addLegalMovesMarkers=this.addLegalMovesMarkers.bind(this),e.removeLegalMovesMarkers=this.removeLegalMovesMarkers.bind(this),this.markerGroupDown=r.B.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=r.B.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.props.autoMarkers,this.props.autoMarkers),this.registerExtensionPoint(i.x.moveInput,(e=>{this.drawAutoMarkers(e)})))}drawAutoMarkers(e){e.type!==o.n1.moveInputFinished&&this.removeMarkers(this.props.autoMarkers),(e.type!==o.n1.moveInputStarted||e.moveInputCallbackResult)&&(e.type!==o.n1.moveInputStarted&&e.type!==o.n1.movingOverSquare||(e.squareFrom&&this.addMarker(this.props.autoMarkers,e.squareFrom),e.squareTo&&this.addMarker(this.props.autoMarkers,e.squareTo)))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach((e=>{this.drawMarker(e)}))}addLegalMovesMarkers(e){for(const t of e)t.promotion&&"q"!==t.promotion||(this.chessboard.getPiece(t.to)?this.chessboard.addMarker(n.bevel,t.to):this.chessboard.addMarker(n.dot,t.to))}removeLegalMovesMarkers(){this.chessboard.removeMarkers(n.bevel),this.chessboard.removeMarkers(n.dot)}drawMarker(e){let t;t="above"===e.type.position?r.B.addElement(this.markerGroupUp,"g"):r.B.addElement(this.markerGroupDown,"g"),t.setAttribute("data-square",e.square);const s=this.chessboard.view.squareToPoint(e.square),i=this.chessboard.view.svg.createSVGTransform();i.setTranslate(s.x,s.y),t.transform.baseVal.appendItem(i);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),a=r.B.addElement(t,"use",{href:`${o}#${e.type.slice}`,class:"marker "+e.type.class}),n=this.chessboard.view.svg.createSVGTransform();return n.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),a.transform.baseVal.appendItem(n),t}addMarker(e,t){"string"!=typeof e&&"object"!=typeof t?(this.markers.push(new c(t,e)),this.onRedrawBoard()):console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x")}getMarkers(e=void 0,t=void 0){if("string"==typeof e||"object"==typeof t)return void console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");let s=[];return this.markers.forEach((i=>{i.matches(t,e)&&s.push(i)})),s}removeMarkers(e=void 0,t=void 0){"string"!=typeof e&&"object"!=typeof t?(this.markers=this.markers.filter((s=>!s.matches(t,e))),this.onRedrawBoard()):console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x")}getSpriteUrl(){return a.A.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class c{constructor(e,t){this.square=e,this.type=t}matches(e=void 0,t=void 0){if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}}},443:(e,t,s)=>{s.d(t,{M:()=>d,O:()=>l});var i=s(521),r=s(410),o=s(892),a=s(547);const n="hidden",h="displayRequested",c="shown",l={pieceSelected:"pieceSelected",canceled:"canceled"};class d extends i.Y{constructor(e){super(e),this.registerExtensionPoint(i.x.afterRedrawBoard,this.extensionPointRedrawBoard.bind(this)),e.showPromotionDialog=this.showPromotionDialog.bind(this),e.isPromotionDialogShown=this.isPromotionDialogShown.bind(this),this.promotionDialogGroup=o.B.addElement(e.view.interactiveTopLayer,"g",{class:"promotion-dialog-group"}),this.state={displayState:n,callback:null,dialogParams:{square:null,color:null}}}showPromotionDialog(e,t,s){this.state.dialogParams.square=e,this.state.dialogParams.color=t,this.state.callback=s,this.setDisplayState(h),setTimeout((()=>{this.chessboard.view.positionsAnimationTask.then((()=>{this.setDisplayState(c)}))}))}isPromotionDialogShown(){return this.state.displayState===c||this.state.displayState===h}extensionPointRedrawBoard(){this.redrawDialog()}drawPieceButton(e,t){const s=this.chessboard.view.squareWidth,i=this.chessboard.view.squareHeight;o.B.addElement(this.promotionDialogGroup,"rect",{x:t.x,y:t.y,width:s,height:i,class:"promotion-dialog-button","data-piece":e}),this.chessboard.view.drawPiece(this.promotionDialogGroup,e,t)}redrawDialog(){for(;this.promotionDialogGroup.firstChild;)this.promotionDialogGroup.removeChild(this.promotionDialogGroup.firstChild);if(this.state.displayState===c){const e=this.chessboard.view.squareWidth,t=this.chessboard.view.squareHeight,s=this.chessboard.view.squareToPoint(this.state.dialogParams.square);s.x=s.x+e/2,s.y=s.y+t/2;let i=!1;const a=parseInt(this.state.dialogParams.square.charAt(1),10);(this.chessboard.getOrientation()===r.o$.white&&a<5||this.chessboard.getOrientation()===r.o$.black&&a>=5)&&(i=!0);const n=i?-4*t:0,h=s.x+e>this.chessboard.view.width?-e:0;o.B.addElement(this.promotionDialogGroup,"rect",{x:s.x+h,y:s.y+n,width:e,height:4*t,class:"promotion-dialog"});const c=this.state.dialogParams;i?(this.drawPieceButton(r.TJ[c.color+"q"],{x:s.x+h,y:s.y-t}),this.drawPieceButton(r.TJ[c.color+"r"],{x:s.x+h,y:s.y-2*t}),this.drawPieceButton(r.TJ[c.color+"b"],{x:s.x+h,y:s.y-3*t}),this.drawPieceButton(r.TJ[c.color+"n"],{x:s.x+h,y:s.y-4*t})):(this.drawPieceButton(r.TJ[c.color+"q"],{x:s.x+h,y:s.y}),this.drawPieceButton(r.TJ[c.color+"r"],{x:s.x+h,y:s.y+t}),this.drawPieceButton(r.TJ[c.color+"b"],{x:s.x+h,y:s.y+2*t}),this.drawPieceButton(r.TJ[c.color+"n"],{x:s.x+h,y:s.y+3*t}))}}promotionDialogOnClickPiece(e){2!==e.button&&(e.target.dataset.piece?(this.state.callback&&this.state.callback({type:l.pieceSelected,square:this.state.dialogParams.square,piece:e.target.dataset.piece}),this.setDisplayState(n)):this.promotionDialogOnCancel(e))}promotionDialogOnCancel(e){this.state.displayState===c&&(e.preventDefault(),this.setDisplayState(n),this.state.callback&&this.state.callback({type:l.canceled}))}contextMenu(e){e.preventDefault(),this.setDisplayState(n),this.state.callback&&this.state.callback({type:l.canceled})}setDisplayState(e){this.state.displayState=e,e===c?(this.clickDelegate=a.A.delegate(this.chessboard.view.svg,"pointerdown","*",this.promotionDialogOnClickPiece.bind(this)),this.contextMenuListener=this.contextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener)):e===n&&(this.clickDelegate.remove(),this.chessboard.view.svg.removeEventListener("contextmenu",this.contextMenuListener)),this.redrawDialog()}}},892:(e,t,s)=>{s.d(t,{B:()=>r});const i="http://www.w3.org/2000/svg";class r{static createSvg(e=void 0){let t=document.createElementNS(i,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,s={}){let r=document.createElementNS(i,t);"use"===t&&(s["xlink:href"]=s.href);for(let e in s)if(s.hasOwnProperty(e))if(-1!==e.indexOf(":")){const t=e.split(":");r.setAttributeNS("http://www.w3.org/1999/"+t[0],t[1],s[e])}else r.setAttribute(e,s[e]);return e.appendChild(r),r}static removeElement(e){e?e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode"):console.warn("removeElement, element is",e)}}},547:(e,t,s)=>{s.d(t,{A:()=>i});class i{static delegate(e,t,s,i){const r=function(e){let t=e.target;for(;t&&t!==this;)t.matches(s)&&i.call(t,e),t=t.parentNode};return e.addEventListener(t,r),{remove:function(){e.removeEventListener(t,r)}}}static mergeObjects(e,t){const s=e=>e&&"object"==typeof e;if(!s(e)||!s(t))return t;for(const s of Object.keys(t))t[s]instanceof Object&&Object.assign(t[s],i.mergeObjects(e[s],t[s]));return Object.assign(e||{},t),e}static createDomElement(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;const s=new Promise((function(s,i){e=s,t=i}));return s.resolve=e,s.reject=t,s}static isAbsoluteUrl(e){return-1!==e.indexOf("://")||e.startsWith("/")}}},521:(e,t,s)=>{s.d(t,{Y:()=>r,x:()=>i});const i={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",beforeRedrawBoard:"beforeRedrawBoard",afterRedrawBoard:"afterRedrawBoard",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class r{constructor(e){this.chessboard=e}registerExtensionPoint(e,t){e===i.redrawBoard&&(console.warn("EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard"),e=i.afterRedrawBoard),this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){console.warn("registerMethod is deprecated, just add methods directly to the chessboard instance"),this.chessboard[e]?log.error("method",e,"already exists"):this.chessboard[e]=(...e)=>t.apply(this,e)}}}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var s=o[e]={exports:{}};return r[e](s,s.exports,a),s.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a.a=(r,o,a)=>{var n;a&&((n=[]).d=-1);var h,c,l,d=new Set,u=r.exports,p=new Promise(((e,t)=>{l=t,c=e}));p[t]=u,p[e]=e=>(n&&e(n),d.forEach(e),p.catch((e=>{}))),r.exports=p,o((r=>{var o;h=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[e])return r;if(r.then){var o=[];o.d=0,r.then((e=>{a[t]=e,i(o)}),(e=>{a[s]=e,i(o)}));var a={};return a[e]=e=>e(o),a}}var n={};return n[e]=e=>{},n[t]=r,n})))(r);var a=()=>h.map((e=>{if(e[s])throw e[s];return e[t]})),c=new Promise((t=>{(o=()=>t(a)).r=0;var s=e=>e!==n&&!d.has(e)&&(d.add(e),e&&!e.d&&(o.r++,e.push(o)));h.map((t=>t[e](s)))}));return o.r?c:a()}),(e=>(e?l(p[s]=e):c(u),i(n)))),n&&n.d<0&&(n.d=0)},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a(325)})();